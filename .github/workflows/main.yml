name: CI
on:
  push:
    branches: [docker]

jobs:
  build:
    runs-on: ubuntu-20.04  # Can be self-hosted if needed

    steps:
      # Checkout the repository
      - name: Checkout Code
        uses: actions/checkout@v3

      # Set up Java 17 (Needed for Buildozer)
      - name: Set up Temurin Java 17
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      # Set up Python (Required for Buildozer configuration)
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # Ensure Buildozer is initialized
      - name: Initialize Buildozer
        run: |
          if [ ! -f buildozer.spec ]; then
            pip install buildozer
            buildozer init
          fi

      # Build APK using Buildozer in Docker
      - name: Build Android APK (Docker)
        run: |
          docker run --rm -v ${{ github.workspace }}:/home/user/app -w /home/user/app kivy/buildozer \
          bash -c "buildozer android debug"

      # Upload the APK as an artifact
      - name: Upload APK artifact
        uses: actions/upload-artifact@v4
        with:
          name: android-apk
          path: bin/*.apk
